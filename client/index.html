<!DOCTYPE html>
<html>
<head>
  <title>HTML5 Platformer Game</title>
  <link rel="shortcut icon" href="./icons/favicon.ico"/>
  <script>
      createjs = window;
  </script>

  <script src="./src/jquery.js"></script>
  <script src="./src/easeljs.js"></script>
  <script src="./src/socket.io.js"></script>
  <script src="./src/bootstrap.js"></script>

  <script src="./src/easeljs/XNARectangle.js"></script>
  <script src="./src/easeljs/PlatformerHelper.js"></script>
  <script src="./src/easeljs/ContentManager.js"></script>
  <script src="./src/easeljs/Sprite.js"></script>
  <script src="./src/easeljs/ProgrammableSprite.js"></script>
  <script src="./src/easeljs/Tile.js"></script>
  <script src="./src/easeljs/Gem.js"></script>
  <script src="./src/easeljs/Enemy.js"></script>
  <script src="./src/easeljs/Player.js"></script>
  <script src="./src/easeljs/Level.js"></script>
  <script src="./src/easeljs/LibraryManager.js"></script>
  <script src="./src/easeljs/LibraryHUD.js"></script>
  <script src="./src/easeljs/GameManager.js"></script>

  <script src="./src/angular.js"></script>
  <script src="./src/angular/rules_controller.js"></script>

  <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="/css/editor.css" rel="stylesheet" media="screen">

  <script>
  var canvas;
  var stage = null;
  var globalCanvasContext;

  window.KEYCODE_SPACE = 32
  window.KEYCODE_UP = 38
  window.KEYCODE_LEFT = 37
  window.KEYCODE_RIGHT = 39
  window.KEYCODE_W = 87
  window.KEYCODE_A = 65
  window.KEYCODE_D = 68
  window.KEYCODE_S = 83



  function start() {
  	if (stage == null) {
  		//find canvas and load images, wait for last image to load
  		canvas = document.getElementById("platformerCanvas");
  		globalCanvasContext = canvas.getContext("2d");
  		stage = new Stage(canvas);

      //find canvas and load images, wait for last image to load
      renderingCanvas = document.getElementById("renderingCanvas");
      renderingStage = new Stage(renderingCanvas);
    }

    // downloading all needed images ressources and preloading sounds & music
    window.Socket = io.connect(':4430', {secure: false});
    window.Socket.on('connect', function () {
        console.log('Socket.io Connection Established.');
        window.Socket.emit('join', { username: 'default' })
    });
    window.Socket.on('disconnect', function () {
        console.log('Socket.io Connection Lost. Trying to reconnect...');
    });

    window.Game = {}
    window.Game.Library = new LibraryManager('default');
    window.Game.Content = new ContentManager(canvas.width, canvas.height);
    window.Game.Manager = new GameManager(stage, renderingStage, canvas.width, canvas.height);
    window.Game.Content.setContentStatusCallback(window.Game.Manager.contentStatusChanged);

    window.rootScope = angular.element('body').scope()
    window.rootScope.Library = window.Game.Library
    window.rootScope.Content = window.Game.Content
    window.rootScope.Manager = window.Game.Manager
  }
  </script>
</head>

<body onload="start()" ng-app>


<div class="navbar navbar-inverse navbar-static-top">
  <div class="navbar-inner">
    <div class="container" style="width:1120px;margin:auto;">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="brand" href="#">Cocoa</a>
<!--       <div class="nav-collapse collapse">
        <ul class="nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
 -->    </div>
  </div>
</div>


<div class="container" style="width:1120px;margin:auto;">
  <div class="row">
    <div class="span10">
      <div class="canvasHolder">
        <canvas id="platformerCanvas" width="800" height="530" style="background-color:black">
          Your browser doesn't support HTML5 Canvas!
        </canvas>
      </div>
    </div>

    <div class="span4" ng-controller="RulesCtrl">
      <div class="well">

      <ul class="unstyled">
        <li class="rule" ng-repeat="rule in rules()">
          <div class="name">{{rule.name}}</div>
          <div class="divider">When:</div>
          <ul>
            <li ng-repeat="trigger in rule.triggers">
              <span class="condition">Key Pressed</span>
              <span class="condition-value">{{trigger.code}}</span>
            </li>
          </ul>

          <div class="divider">Then:</div>
          <div class="scenario">
            <img ng-src="{{scenario_before_url(rule)}}"/>
            <div class="arrow">-></div>
            <img ng-src="{{scenario_after_url(rule)}}"/>
          </div>

        </li>
      </ul>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="span12" ng-controller="LibraryCtrl">
      <div class="well">
      Well
      </div>
    </div>
  </div>
</div>


<canvas id="renderingCanvas" width="300" height="300" style="background-color:black">
  Your browser doesn't support HTML5 Canvas!
</canvas>




</body>
</html>
