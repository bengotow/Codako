<!DOCTYPE html>
<!-------------------------------------------------------------------------------
// HTML5 Platformer game
//
// Inspired by the Microsoft XNA Community Game Platformer Sample
// Copyright (C) Microsoft Corporation. All rights reserved.
// Ported to HTML5 Canvas with EaselJS by David Rousset - http://blogs.msdn.com/davrous
// Checkout EaselJS: an open-source JavaScript gaming framework : http://easeljs.com  
//------------------------------------------------------------------------------->
<html>
<head>
<title>HTML5 Platformer Game</title>
<link rel="shortcut icon" href="./icons/favicon.ico"/>
<META name="msapplication-task" content="name=XNA 4.0 Platformer Sample;action-uri=http://create.msdn.com/en-US/education/catalog/sample/platformer;icon-uri=./icons/XNA.ico"/>
<META name="msapplication-task" content="name=Tutorial: Animating sprites in Canvas with EaselJS;action-uri=http://blogs.msdn.com/b/davrous/archive/2011/07/21/html5-gaming-animating-sprites-in-canvas-with-easeljs.aspx;icon-uri=./icons/blogicon.ico"/>
<META name="msapplication-task" content="name=Tutorial: Building the core objects & handling collisions with EaselJS;action-uri=http://blogs.msdn.com/b/davrous/archive/2011/07/29/html5-gaming-building-the-core-objects-amp-handling-collisions-with-easeljs.aspx;icon-uri=./icons/blogicon.ico"/>
<META name="msapplication-task" content="name=Build my pinned site;action-uri=http://buildmypinnedsite.com;icon-uri=./icons/mypinnedsites.ico"/>

<script>
    createjs = window;
</script>

<!- Import EaselJS Framework -->
<script src="./src/easeljs.js"></script>
<script src="./src/socket.io.js"></script>

<script src="./src/easeljs/XNARectangle.js"></script>
<script src="./src/easeljs/PlatformerHelper.js"></script>
<script src="./src/easeljs/ContentManager.js"></script>
<script src="./src/easeljs/Sprite.js"></script>
<script src="./src/easeljs/ProgrammableSprite.js"></script>
<script src="./src/easeljs/Tile.js"></script>
<script src="./src/easeljs/Gem.js"></script>
<script src="./src/easeljs/Enemy.js"></script>
<script src="./src/easeljs/Player.js"></script>
<script src="./src/easeljs/Level.js"></script>
<script src="./src/easeljs/LibraryManager.js"></script>
<script src="./src/easeljs/GameManager.js"></script>

<script>
var canvas;
var stage = null;
var globalCanvasContext;

window.KEYCODE_SPACE = 32
window.KEYCODE_UP = 38
window.KEYCODE_LEFT = 37
window.KEYCODE_RIGHT = 39
window.KEYCODE_W = 87
window.KEYCODE_A = 65
window.KEYCODE_D = 68
window.KEYCODE_S = 83



function start() {
	if (stage == null) {
		//find canvas and load images, wait for last image to load
		canvas = document.getElementById("platformerCanvas");
		globalCanvasContext = canvas.getContext("2d");
		stage = new Stage(canvas);
  }

  // downloading all needed images ressources and preloading sounds & music
  window.Socket = io.connect(':4430', {secure: false});
  window.Socket.on('connect', function () {
      console.log('Socket.io Connection Established.');
      window.Socket.emit('join', { username: 'default' })
  });
  window.Socket.on('disconnect', function () {
      console.log('Socket.io Connection Lost. Trying to reconnect...');
  });

  window.Game = {}
  window.Game.Library = new LibraryManager('default');
  window.Game.Content = new ContentManager(canvas.width, canvas.height);
  window.Game.Manager = new GameManager(stage, canvas.width, canvas.height);

  window.Game.Content.setContentStatusCallback(window.Game.Manager.contentStatusChanged);
}


//********************************************************
</script>
</head>

<body onload="start()">
	<div class="canvasHolder">
		<canvas id="platformerCanvas" width="800" height="480" style="background-color:black">
			Your browser doesn't support canvas. Please download IE9+ on <a href="http://ie.microsoft.com/testdrive">IE Test Drive</a> 
		</canvas>
	</div>
	<button id="Start" onclick=restart();>(Re)Start</button>
</body>
</html>
