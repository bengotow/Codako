<!DOCTYPE html>
<html>
<head>
  <title>HTML5 Platformer Game</title>
  <link rel="shortcut icon" href="./icons/favicon.ico"/>
  <script>
      createjs = window;
  </script>
  <script type="text/javascript" src="./src/async.js"></script>

  <script src="./src/jquery.js"></script>
  <script src="./src/easeljs-NEXT.min.js"></script>
  <script src="./src/socket.io.js"></script>
  <script src="./src/bootstrap.js"></script>
  <script src="./src/bootstrap-colorpicker.js"></script>
  <script src="./src/extensions.js"></script>
  <script src="./src/underscore.js"></script>

  <link href="./src/jquery-ui.css" rel="stylesheet" type="text/css" />
  <script src="./src/jquery-ui.min.js"></script>


  <script src="./src/models/XNARectangle.js"></script>
  <script src="./src/models/ContentManager.js"></script>
  <script src="./src/models/Sprite.js"></script>
  <script src="./src/models/Rule.js"></script>
  <script src="./src/models/GroupRule.js"></script>
  <script src="./src/models/ActorDefinition.js"></script>
  <script src="./src/models/ActorSprite.js"></script>
  <script src="./src/models/SquareMaskSprite.js"></script>
  <script src="./src/models/HandleSprite.js"></script>
  <script src="./src/models/PixelArtCanvas.js"></script>
  <script src="./src/models/LibraryManager.js"></script>
  <script src="./src/models/GameStage.js"></script>
  <script src="./src/models/GameManager.js"></script>

  <script src="./src/angular.js"></script>
  <script src="./src/angular/directives.js"></script>
  <script src="./src/angular/controls_controller.js"></script>
  <script src="./src/angular/variables_controller.js"></script>
  <script src="./src/angular/rules_controller.js"></script>
  <script src="./src/angular/pixel_art_controller.js"></script>
  <script src="./src/angular/library_controller.js"></script>

  <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="/css/editor.css" rel="stylesheet" media="screen">
  <link href="/css/colorpicker.css" rel="stylesheet" media="screen">

  <script>
  function start() {
		//find canvas and load images, wait for last image to load
		stagePane1 = new GameStage($("#platformerCanvasPane1")[0]);
    stagePane2 = new GameStage($("#platformerCanvasPane2")[0]);
    renderingStage = new Stage($("#renderingCanvas")[0]);

    // downloading all needed images ressources and preloading sounds & music
    window.Socket = io.connect(':4430', {secure: false});
    window.Socket.on('connect', function () {
        console.log('Socket.io Connection Established.');
        window.Socket.emit('auth', { username: 'default', password: '' })
        levelIdentifier = window.location.href.split('#')[1].replace('/','');
        if (levelIdentifier == undefined)
          return alert('You need to open a level. Please check the url for #levelIdentifier')
        window.Game.load(levelIdentifier)
    });
    window.Socket.on('disconnect', function () {
        console.log('Socket.io Connection Lost. Trying to reconnect...');
    });

    $(document).mousedown(function(e){
      window.mouseIsDown = true;
    });
    $(document).mouseup(function(e){
      window.mouseIsDown = false;
    });

    window.Game = new GameManager(stagePane1, stagePane2, renderingStage);
    window.rootScope = angular.element('body').scope()
  }
  </script>
</head>

<body onload="start()" ng-app="App">

  <div class="navbar navbar-inverse navbar-static-top">
    <div class="navbar-inner">
      <div class="container" style="width:1180px;margin:auto;">
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="brand" href="#">Kodako</a>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="dropdown">
              <a id="drop1" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">My World <b class="caret"></b></a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="http://google.com">Stage Settings</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="width:1180px; margin:auto;" ng-controller="ControlsCtrl" ng-cloak>
    <div id="tool-box" class="white-box" style="float:left;line-height:0;width:40px;">
      <div class="{{class_for_btn(tool() == 'pointer')}} btn-tool-first" ng-click="set_tool('pointer')"><img src="img/sidebar_pointer.png"></div>
      <div class="{{class_for_btn(tool() == 'record')}} btn-tool" ng-click="set_tool('record')"><img src="img/sidebar_record.png"></div>
      <div class="{{class_for_btn(tool() == 'paint')}} btn-tool" ng-click="set_tool('paint')"><img src="img/sidebar_paint.png"></div>
      <div class="{{class_for_btn(tool() == 'delete')}} btn-tool" ng-click="set_tool('delete')"><img src="img/sidebar_trash.png"></div>
    </div>

    <div id="viewport-box" class="white-box" style="float:left;line-height:0;">
      <div style="overflow:hidden; width:800px; height:520px;">
        <div style="width:1605px; height:520px;">
          <canvas droppable id="platformerCanvasPane1" width="800" height="520" class="stage">
            Your browser doesn't support HTML5 Canvas!
          </canvas>
          <canvas droppable id="platformerCanvasPane2" width="0" height="520" class="stage">
          </canvas>
        </div>
      </div>

      <div class="controls"
           ng-include="'/src/angular/controls_controller/'+control_set+'.html'"
           style="text-align:center;">
      </div>
    </div>


    <div id="sidebar-box" class="white-box" style="float:right; width:280px;" ng-cloak>
      <ul class="nav nav-tabs">
        <li class="active"><a href="#rules" data-toggle="tab">Rules</a></li>
        <li><a href="#variables" data-toggle="tab">Variables</a></li>
      </ul>

      <div class="tab-content">
        <div id="rules"
             ng-controller="RulesCtrl"
             ng-include="'/src/angular/rules_controller.html'"
             class="tab-pane active">
        </div>

        <div id="variables"
             ng-controller="VariablesCtrl"
             ng-include="'/src/angular/variables_controller.html'"
             class="tab-pane"
             droppable='{"scope":"variable"}'>
        </div>
      </div>
    </div>

    <div id="library"
         ng-controller="LibraryCtrl"
         ng-include="'/src/angular/library_controller.html'" ng-cloak>
    </div>

  </div>


  <div id="pixelArtModal"
       ng-controller="PixelArtCtrl"
       ng-include="'/src/angular/pixel_art_controller.html'"
       class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true" style="width:671px;" data-backdrop="static" ng-cloak>
  </div>

  <!-- Offscreen Resources for Rendering / Debugging -->
  <div style="display:none;">
    <canvas id="renderingCanvas" width="300" height="300" style="background-color:black">
      Your browser doesn't support HTML5 Canvas!
    </canvas>
  </div>

</body>
</html>
